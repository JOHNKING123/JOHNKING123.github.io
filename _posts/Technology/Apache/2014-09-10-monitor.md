---
layout: post
title: 关于集群监控
category: 技术
tags: WEB
keywords: 集群 监控 ganglia zabbix
---

## 前言 ##

为什么需要监控集群，其实这个问题都不用谈了。成百上千台机器在哪里工作，如果不知道它们的工作状态，岂不是一件很虚的事情。还有，如果没有监控，你怎么评价你的程序是否高效，仅仅凭能够执行通过么？

## 监控软件的一些基本特点 ##

到目前为止，我只学习过ganglia和zabbix，通过它们，我发现监控软件一般有以下基本特点：

- 从架构上讲，是分布式软件，主节点和从节点都会运行程序，主节点程序（以下称为server）负责收集从节点数据并分析展示，从节点程序（以下成为agent）负责采集本节点的状态信息。
	- 如果节点不多，且都属于同一个地域，则一个server对应多个agent即可满足要求。
	- 如果节点众多，监控地域不一，数据和网络开销较大，则server和agent之间，多加一个代理(proxy)，代理替server进行所管理agent数据的收集，并向server汇报。

- 数据采集的工作模式一般分为：主动模式和被动模式
	这是从agent的角度来看的，主动模式即agent主动上报数据，这样可以让server轻松一些。

- 采集节点数据有以下两种方式：
	- 专用客户端采集，从节点运行专用程序获取本机状态数据
	- 共用协议采集，即（server）利用SNMP或SSH等协议采集从节点数据

- 服务器端拿到采集的数据后，会以某种形式将数据存储起来（数据库或文本）。同时，这类软件还会准备web脚本或代码，我们可以将这些web脚本复制到http服务器的相关目录下。http服务器启动后，这些web脚本便会访问存储起来的数据，将结果以图形方式展现出来。以ganglia架构为例：

	![Alt text](/public/upload/frame_of_ganglia.png)

- 一般会带有报警功能，即如果某项指标大于设定的阈值，会触发邮件、短信和声音等动作。

- 一般可以自定义指标，只要符合接口规则，我们便可以采集我们想收集的个性化数据。

- 一般会为我们准备/etc/init.d下的启动脚本，我们只需将其复制到/etc/init.d下即可。

安装监控软件的过程一般比较复杂，针对以上特点，安装软件时，一般会有以下操作（顺序跟实际不一致）：

- 需要分别安装server和agent端
- 需要配置工作模式
- server端需要安装数据库，并在server端配置文件中指明数据库路径，创建数据库用户。个别软件安装时，还需要初始化数据库（zabbix）。个别软件安装时，数据库目录要设置数据库用户。server端需要安装http服务器，相应目录设置为apache用户。图形化展示一般会带有模板，如何展示又需要一番配置。
- 配置event
- 找到相应的配置文件，告诉它我只想收集某些指标

## 我用过的一些监控软件 ##
### ganglia ###

### zabbix ###