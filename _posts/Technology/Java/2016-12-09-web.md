---

layout: post
title: 对web系统的一些理解
category: 技术
tags: Java
keywords: web

---

## 前言

抽象，是一个宝贵的工具，能叫人们在更高的角度看待问题。

将要解决的问题抽象成一个模型，并根据对问题的理解不断的修正这个模型，最终利用这个模型去指导实践。这就是为什么人们要将繁杂的军事谋略抽象成孙子兵法，最终浓缩成一句话：致敌而不致于敌。

本文谈一谈对web系统设计的理解，从中抽象出一点理念性的东西，以为日后所复用。

## 存储,缓存,查询模型

现在网站数据一般会存储在数据库中，关于数据库表的设计，教科书上有三大范式，然而在实际实施时，有很多违反三大范式的设计（比如一定的冗余），或者为了数据安全，或者为了快速查询，这就说明数据的应用场景和数据的最优存储模型之间存在冲突。

一次写入，伴随一些变化，进而改变用户的查询结果。有时候不得不做一些取舍：是为了插入方便，还是为了查询方便。

本文将数据可能出现的形式归纳为三种模型：存储、缓存和查询模型。

存储模型，总的来说，尽量按三大范式进行

1. 存储模型的底线是：要存储所有必要的的数据。这句话并不是废话，这告诉我们在设计表结构时，要包含哪些数据。进而再去考虑将这些字段分散在哪些表中。
1. 尽量面向添加
2. 一次操作要尽量少,比如,服务端改动一个东西要改四五条关联记录。

现在的业务系统中，越来越多的用到了缓存，多数为`<key,model>`形式，那么这个model是否一定为数据库的model呢？

1. 缓存应该尽量面向查询，最好客户端传入一个key，直接从缓存中返回model。从这个角度看，model不一定是数据库model。
2. 客户端的情况可能千变万化，很难hash到一定范围的key空间，因此有时候缓存没必要完全就面向查询。

查询模型

1. 查询要尽量简化用户的操作,比如减少用户的传参数。

在设计的时候,还要兼顾系统的复杂性,至少理念上不能太复杂。

存储、缓存和查询模型的演化，就好比是os的发展,系统调用提供基本的功能,然后库函数不停地向上封装。

## 监控

知道你目前的系统的所处的状态，每个调用花了多上时间，哪些点是瓶颈。

## 架构设计

1. 所有代码在一个项目
2. 不同业务代码拆开
3. 不同业务代码的公共模块拆出，形成微服务。数据层面，加入缓存，读写分离。
4. 业务层面要有监控报警、流控、降级、扩容缩容等措施。数据层面，要有异地多活等措施。


