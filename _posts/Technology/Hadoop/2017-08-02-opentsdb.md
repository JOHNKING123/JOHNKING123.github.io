---
layout: post
title: OpenTSDB
category: 技术
tags: Hadoop
keywords: OpenTSDB
---

## 前言 (未完成)

网站主页 [opentsdb](http://opentsdb.net/)

[Opentsdb简介（一）](http://www.jianshu.com/p/0bafd0168647)

OpenTSDB is a distributed, scalable Time Series Database (TSDB) written on top of HBase

重点就是两个事情：实现架构；数据存储格式

突击官方文档与实践相结合


## 架构实现

1. OpenTSDB is primarily achieved by running one or more of the TSDs. Each TSD is independent.
2. store and retrieve time-series data
3. There is no master, no shared state so you can run as many TSDs as required to handle any load you throw at it.


![](/public/upload/hadoop/open_tsdb_1.png)

可以看到

1. 底层是hbase 存储
2. 中间是 Time Series Daemon (TSD) 
3. 周边是 运行在各个server 的collector，web ui，脚本等

## 简单使用


## 数据结构

time series 基本构成：key value + timestamp + tag，key value用来存储数据

**这种存储结构是后面一堆儿事儿（约束、原则、规范）的核心**

tag 作用有两个： 

* 用来支持多维查询
* the uniqueness comes from a combination of tag key/value pairs that allows for flexible queries with very fast aggregations. 通过 tag的组合来实现 对key 的定位。

基于这个基本结构

1. 如何节省存储空间？opentsdb 有两张表，一张表存储数据本身，一张表存储 metric name、tag name、tag value 到一个unique id 的映射关系。metrics, tag name, tag value的编码长度都是3byte, 所以UID的数量上限为 2^24 个。
2. 如果提高查询效率？
3. 查询方式

## tips

1. opentsdb 由java编写，启动方式类似hadoop、zookeeper 等 二进制脚本包裹的方式
2. 第一次启动时候，运行指定脚本创建hbase表
3. OpenTSDB can be configured via a file on the local system, via command line arguments or a combination or both.
6. [Querying or Reading Data](http://opentsdb.net/docs/build/html/user_guide/query/index.html)

## 优化措施


2. 尽管时间戳可以存储到 毫秒，但返回的结果还是按秒的