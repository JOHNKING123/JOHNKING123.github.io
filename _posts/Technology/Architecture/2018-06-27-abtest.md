---

layout: post
title: abtest 系统设计
category: 技术
tags: Architecture
keywords: abtest

---

## 简介（未完成）



[沪江ABTest测试平台实践](https://mp.weixin.qq.com/s/FjuUHg7YMdWUIoc4sp2TWA) 主要内容如下：

实验的两个要素：

1. 流量。其实就是selector，如何分流
2. 参数。其实就是bucket/action ，分流后的动作

流量模型的几个基本概念

1. 域，流量的一个划分，比如日语用户
2. 层，不同实验层间进行独立的流量划分和独立的实验，互不影响。
3. 实验，上文讲过了 


不同终端采用不同的用户标识id来hash分流

1. web端采用 cookieId 
2. app端采用设备id
3. 小程序端采用 openID 作为唯一标识符

具体进行流量划分时，为了实现实验层之间流量划分的正交性，会将流量标识信息和实验层标识一起进行实验流量 bucket 划分， 实验层标识 salt 称为离散因子。`bucket id = hash(uid,salt) % 100`

tips

1. 为了便于内测等，我们也实现了白名单功能，运营或者产品可以通过后台配置某用户命中某个特定的实验参数。
2. 在实际线上运行ab测试的时候，我们经常需要针对某个实验参数做流量的扩量或者缩量。

	|实验变量|A|B|C|
	|---|---|---|---|
	|切换前bucket区间|0-79|80-89|90-99|
	|将C扩容10个百分比|0-74|75-79|80-99|
	
	切换之后实际上A，B和C覆盖的用户人群都发生了变化。其实更佳的扩缩量方案是：B流量不变，C从A切换 10% 流量过去，这样可以尽量减少对覆盖用户人群参与实验的变化。
	
实验平台架构 后续部分还未看完。
	



## 效果评估

1. 靠后台关联。ab 系统后台记录 打点日志，内容类似于 who when 拿到的 方案A/B 的响应。 