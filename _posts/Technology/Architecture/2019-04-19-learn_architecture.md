---

layout: post
title: 如何学习架构
category: 架构
tags: Architecture
keywords: learn architecture

---

## 简介

* TOC
{:toc}

借助[如何学习分布式系统](http://qiankunli.github.io/2018/04/16/learn_distributed_system.html) 得来的经验，当一个知识足够复杂，如何学习它本身就很值得玩味

[以业务为核心的云原生体系建设](https://mp.weixin.qq.com/s/PGJ042nAsRTVF-bvfVtbqQ)

![](/public/upload/architecture/architecture_all.png)

## 架构类资料

到目前为止，笔者关于架构的几篇文章或笔记

1. [《软件架构设计》笔记](http://qiankunli.github.io/2019/04/16/architecture_design_note.html)
2. [反应式架构摸索](http://qiankunli.github.io/2019/01/21/reactive_architecture.html)
3. [业务系统设计的一些体会](http://qiankunli.github.io/2018/09/28/business_system_design.html)
4. [《左耳听风》笔记](http://qiankunli.github.io/2018/09/08/zuoertingfeng_note.html)
5. [《从0开始学架构》笔记](http://qiankunli.github.io/2018/05/06/architecture_from_0_note.html)

按照许式伟的说法，架构相关的图书大概有几类

1. 架构思维类。 通常从一些著名的架构理论讲起，比如开闭原则、单一职责原则等等。其弊端在于过度理论化，而计算机科学归根到底属于工程技术类，应该实践第一。
2. 设计模式类。 这类一般上来就进入架构的局部细节，每个模式的来龙去脉并不容易理解。就算理解了某个具体的模式，也很难真正做到活学活用。
3. 分布式系统架构设计类。 通常从服务端的通用问题如一致性、高可用、高并发挑战等话题讲起，阐述大型业务系统面临的挑战。这些知识虽然非常有价值，但无法延伸至通用业务架构，对大部分企业的架构实践不具备真正的指导意义。
4. 重构类。 主要讲如何如何改进代码，其实是最实用的一类。但在我看来，一个模块最初的地基是最重要的，基本决定了这座大厦能够撑多久，而重构更多侧重于大厦建成之后，在服务于人的前提下怎么去修修补补，延长生命。

也有人主张：最好的软件设计是简单易懂的设计，[软件架构被高估，清晰简单的设计被低估](https://mp.weixin.qq.com/s/1ffiH9ODSzcr79IknW6QSw)

1. 拉过来一名同事，在白板上写下你的设计方法。写出你在做什么，为什么要这么做，征求他们的意见
2. 设计两种方案，并进行对比。**大多数人在设计架构时都只采用一种方法，就是突然出现在他们脑海中的方法**。提出第二个同样可行的设计。对比两者，解释为什么一个比另一个更好。简要列出第二种设计作为备选方案，并说明为什么决定不用它。


## 架构

[应用架构之道：分离业务逻辑和技术细节](https://mp.weixin.qq.com/s/F5BWyALjJxryZXfb8WcH9g)任何事物都是规则性和随机性的组合。规范的意义就在于我们可以将规则性的东西固化下来，尽量减少随心所欲带来的复杂度，一致性可以降低系统复杂度。从命名到架构皆是如此，而架构本身就是一种规范和约束，破坏这个约束，也就破坏了架构。

### 架构是什么

[从方法到思维：什么是应用逻辑架构的正确姿势？](https://mp.weixin.qq.com/s/6bYQK305VcqHruT1nmuO7w) 作者一直尝试对“架构是什么”进行有一定高度的提炼。发现了一句话：The fundamental organization of a system, embodied in its components, their relationships to each other and the environment, and the principles governing its design and evolution.　　根据这个定义，Architecture = Structure of Components + Relationships + Principles&Guidelines，我们在架构中需要：

1. 职责明确的模块或者组件
2. 组件直接的关联关系非常明确
3. 需要有约束和指导原则

### 架构要解决的问题

语言、数据结构、算法、中间件使用等属于硬的内容，比如容易表述，也容易衡量。而架构设计，系统的“三高”则属于“隐性问题”

1. 因为一个系统设计问题导致研发人力的投入和时间成本的增加
2. 业务确实很复杂，做新功能有沉重的历史包袱，最终技术拖累业务

架构是针对所有重要问题做出的重要决策。很显然，不同公司不同阶段碰到的问题不同，架构所做的事情自然也不一样。

架构的道

1. 对于技术问题，主要指高并发、高可用和一致性方面
2. 对于业务问题，主要指业务的需求分析和业务建模

![](/public/upload/architecture/architecture.png)

|道|术|
|---|---|
|内功心法|外功招式|
|知（理论）|行（实践）|
|**问题**|**答案**|


### 当你不具体负责某一个业务或系统，如何看待架构，如何让架构体现价值

[我对云原生软件架构的观察与思考](https://mp.weixin.qq.com/s/PwPC1ZWNZvzQoOZvOAF2Qw)软件架构主要目标是解决下列挑战：

1. 控制复杂性。由于业务的复杂性，需要我们用更好的手段帮助研发组织克服认知障碍，更好的分工协作。分而治之，关注点分离等手段皆是如此。PS：容器发布系统就深有体会， 和小伙伴代码风格不一致，一开始设计没做好，就是单纯的实现接口，新需求多个地方都可以加或改，导致最后代码完全 随着一个人的风格失控
2. 应对不确定性。业务在快速发展，需求在不断变化。即使再完美的软件架构，然而随着时间的推移，团队的变化，软件架构的调整不可避免。读《设计模式》，《微服务设计》等书字里行间写的都是“解耦”两字，让我们关注架构中确定性和不确定性的分离，提升架构的稳定性和应变能力。PS：此外一定要明确核心设计，判断核心设计是否考虑过、cover到新需求，如果cover 不到，就要更新设计，而不是勉强实现。在软件设计的摸索阶段，尤其要避免复杂性
3. 管理系统性风险。管理系统中的确定性以及不确定性风险，规避已知陷阱，对未知的风险做好准备。

![](/public/upload/architecture/tech_value.png)

更抽象一下就是：业务对技术有什么要求？支持更多业务，响应更快，能服务越来越多人（更强），低成本。资源伸缩、资源成本（这两个阿里已接近解决）、研发效率。

WWW的发明人蒂姆.伯纳斯.李谈到设计原理时说过：简单性和模块化是软件工程的基石；分布式和容错性是互联网的生命。

[阿里毕玄：系统架构师如何做好系统设计？](https://mp.weixin.qq.com/s/LrpvaAQSn_TITMwH7XhG3A)

1. 有了清晰的可衡量的系统建设的目标，最容易遗漏的一点，是可以做一个用来跟踪系统建设效果的系统
2. 从可衡量的目标映射到技术层面要去解决的核心问题，是很需要技术功底的。如果要达成系统设计的可衡量的目标，到底面临了一些什么核心问题，只有明白了面临什么核心问题，才能更加明确的进行系统设计来解决这些问题。
3. 访问量大的系统最重要的是对整个系统的处理过程要非常的清楚，因为在访问量大的情况下，一些小的问题有可能会放大成很大的问题，进而到故障，所以访问量大的系统对技术的可控性要求是极高的

![](/public/upload/architecture/ali_architecture_in_distribute.png)

单点带来的性能、容量瓶颈 以及研发协作效率瓶颈 逼着进行了分布式改造。

![](/public/upload/architecture/ali_architecture_multi_unit.png)

![](public/upload/architecture/ali_architecture_cloud.png)

云时代的软件架构走向何方？

1. 第一点是弹性，我可以有高峰就用、没有高峰就退。
2. 第二点，业务研发团队会越来越不关注下面是什么，越来越脱离下面这一层。一个新人加入进来，可以不管那么多context就可以去实现业务需求。

![](/public/upload/architecture/ali_architecture_future.png)

## 具体的架构分类

![](/public/upload/architecture/architecture_category.png)

## 系统架构

* 微服务 
* 一个问题在一个进程的多线程间存在，多半也在一台机器的多进程，多台机器的多进程间存在，而解决问题的思路多半是一样的，这也是学习基础的必要性所在。比如[一分钟实现分布式锁](http://www.10tiao.com/html/249/201612/2651959749/1.html)

[谈谈互联网后端基础设施](https://yq.aliyun.com/articles/66115)要点：

1. Api网关 
2. 业务应用和后端基础框架 
3. 缓存、数据库、搜索引擎、消息队列、文件存储 
4. 统一认证中心 单点登录系统 
5. 统一配置中心 
6. 服务治理框架 
7. 统一日志服务 
8. 数据基础设施 
9. 故障监控

这里的后端基础设施主要指的是应用在线上稳定运行需要依赖的关键组件/服务等。开发或者搭建好以上的后端基础设施，一般情况下是能够支撑很长一段时间内的业务的。此外，对于一个完整的架构来说，还有很多应用感知不到的系统基础服务，如负载均衡、自动化部署、系统安全等

![](/public/upload/architecture/high_availability.png)

## 业务架构

**业务的本质是模型**。如果我们能基于复杂业务场景抽象出领域模型或者基于复杂业务场景做流程编排，做好分层，不仅反映你对业务认知的深度，也反映了你的技术深度。

《软件架构设计》为什么要区分“业务架构”和“技术架构”？要时刻意识到我们面对的是业务问题还是技术问题。

1. 能够通过架构设计降低业务代码修改（对应功能的增删改）的难度吗？
2. 如果能，如何通过架构设计降低业务代码修改的难度？

### 方法论

![](/public/upload/architecture/businese_thought.png)

很多时候会遇到这样的情况：一个函数写了几百行代码，里面的if-else写了很多，计算各种业务规则。另一个人接手后，分析了好几天，才把业务逻辑彻底理清楚。**这个问题表面上看是代码写的不规范、要重构。从根本上讲，就是重要逻辑隐藏在代码里面，没有”显性“的表达出来**。这只是一个函数，推广到类、模块、系统，是同样的道理。

所以，**建模的本质就是：把重要的东西进行显性化，进而把这些显性化的构造块互相串联起来，组成一个体系。让它在”设计图纸“上可见，而不是分析完代码才能看出来**。重要的东西找到了，如何显性化呢？其实就是”命名“

### 典型/非典型架构

1. 典型架构：browser—server，app-server
	
	* [关于互联网“一致性”架构设计的一切](http://www.10tiao.com/html/249/201709/2651960408/1.html)
	* [互联网分层架构的本质](http://www.10tiao.com/html/249/201710/2651960455/1.html) 文章要点：互联网分层架构的本质，是数据的移动；互联网分层架构中，数据的传输格式（协议）与数据在各层次的形态很重要；互联网分层架构演进的核心原则与方法：封装与复用
	
2. 非典型架构：[秒杀，推送，广告，推荐，计数-互联网非典型业务系统架构设计](http://www.10tiao.com/html/249/201709/2651960426/1.html)

### 通用设计

1. 满足业务需求
2. 解耦 [为什么说解耦的战术，决定了架构的高度？](http://www.sohu.com/a/204009990_411876)

	* ip耦合：使用内网域名代替内网ip
	* 公共库耦合：业务个性强的垂直拆分，公共特性强的下沉服务化
	* 数据库耦合：垂直切分与服务化
	* 服务化耦合：剥离业务代码上浮
	* 消息通知耦合：MQ
	* 下游扩容耦合：配置中心

[互联网架构：屡试不爽的架构三马车](https://mp.weixin.qq.com/s/VBGeI308sbTn8qNY-wASjQ)：微服务、消息队列和定时任务

![](/public/upload/architecture/business_architecture.png)

## 架构的推导思路

[从方法到思维：什么是应用逻辑架构的正确姿势？](https://mp.weixin.qq.com/s/6bYQK305VcqHruT1nmuO7w) 

许式伟

1. 架构就是对业务系统的**正交分解**。
2. 架构行为的三步曲：“需求分析”、“概要设计”、模块的 “详细设计”，背后都直指业务的正交分解，只是逐步递进，一步步**从模糊到越来越强的确定性**，直至最终形成业务设计的完整的、精确无歧义的解决方案。
3. 比框架（架构图）更重要的是数据结构，**比数据结构更重要的是接口**。为什么数据结构比框架（架构图）更重要？业务数据结构是架构实现机制的灵魂。从共识确认的角度，数据结构相比框架而言，是更重要的共识。为什么接口更重要？接口是需求的流程分解，即可以体现用户地图。**接口是业务的抽象，同时也是它与使用方的耦合方式**。一些架构师能够想清楚实现，但是想不清楚业务。他们用实现替代对业务系统的抽象。**用实现机制替代业务的典型案例是定义了数据结构，但是不抽象数据的业务逻辑**，直接让使用方操作成员变量，或者定义一堆成员变量的 get/set 接口（PS：这个方法/接口不体现业务）。关注业务接口的定义，我们自然就把焦点转向关注业务如何由相互正交的子业务组合而来。PS：**作为小组leader，只是设计好了db表结构，并不能防止小伙伴写出读不懂的代码**。
4. 架构过程是团队共识形成与确认的过程。共识是需要精确的、无歧义的。而架构图显然并不精确。团队没有精确的共识很可怕，它可能导致不同模块的工作牛头不对马嘴，完全无法连接起来，但是这个风险没有被暴露，直到最后一刻里程碑时间要到了，要出版本了，大家才匆匆忙忙联调，临时解决因为架构不到位产生的“锅”。这时候人们的动作通常会走形。追求的不再是架构设计的好坏，而是打补丁，怎么把里程碑的目标实现了，别影响了团队绩效。更精确描述架构的方法是定义每个模块的接口。接口可以用代码表达，这种表达是精确的、无歧义的。架构图则是辅助模块接口，用于说明模块接口之间的关联。为了证明接口的有效性，架构师还应该过一遍所有的用户故事，以伪代码或流程图的方式，把所有用户故事过一遍，确认模块之间的接口串起来是可以正常工作的。**代码即文档。代码是理解一致性更强的文档**。这样做的好处是，我们把联调工作做到了前头，工程的最大风险就得到了管理。剩下来的就是每个模块自身的好坏，这就和组织能力无关，只取决于我们招聘的工程师个体素质了。**所以模块的接口，是架构设计的核心**。

许式伟：架构就是对业务系统的**正交分解**。因此，整个信息科技的演化过程，自然而然形成了分层：基础架构 + 业务架构。基础架构的产生是对业务架构不断深入理解的过程。越来越多的共性需求从业务架构抽离出来，成为信息科技的基础设施。作为架构师，我们需要坚持对业务进行正交分解的信念，要坚持不断地探索各类需求的架构分解方法。这样的思考多了，我们就逐步形成了各种各样的架构范式。这些架构范式，并不仅仅是一些架构思维，而是 “一个个业务只读、接口稳定、易于组合的模块 + 组合的方法论”，它们才是架构师真正的武器库。**发现架构无法很方便地支持某个需求，就意味着架构存在缺陷**。


架构分解中有两大难题：其一，需求的交织。不同需求混杂在一起，也就是存在所谓的全局性功能。其二，需求的易变。不同客户，不同场景下需求看起来很不一样，场景呈发散趋势。我们核心要掌握的架构设计的工具其实就只有两个：
1. 组合。用小业务组装出大业务，组装出越来越复杂的系统。
2. 如何应对变化（开闭原则）。和“架构的本质是业务的正交分解”一脉相承，与其修改模块的业务，不如实现一个新业务。只要业务的分解一直被正确执行的话，实现一个新的业务模块来完成新的业务范畴，是一件极其轻松的事情。模块的业务变化点，简单一点的，通过回调函数或者接口开放出去，交给其他的业务模块。复杂一点的，通过引入插件机制把系统分解为 “最小化的核心系统 + 多个彼此正交的周边系统”。事实上回调函数或者接口本质上就是一种事件监听机制，所以它是插件机制的特例。

## 从架构的过去看未来

[京东刘海锋：过去十年架构领域最重要的三个变化](https://mp.weixin.qq.com/s/_W9vUK8LY9RC1-QxfGFQSg)

架构领域经历了快速演进的十年。架构领域在整个互联网的技术栈是偏底层的，但过去十年架构领域的演进速度，一点都不亚于应用开发，甚至移动端开发的速度。比如容器，新型的数据库，新型的中间件，大规模集群的调度，以及系统跟算法的结合。比如

1. 容器
2. 数据库，数据库作为基础架构非常核心的组成部分，在过去的十年间里面有一个显著的特点是从大一统的一元的数据库逐渐走向多元，逐渐的走向为不同的应用场景而定制。以电商为例，一般来说会用 MySQL 以及 MySQL 的中间件，作为最关键的结构化存储，但同时会配上内存 KV Store 做加速、用检索型数据库做全文检索，用时间序列数据库做海量数据的监控采集和分析，等等。从 DB 底层核心技术来看，跨地域复制且强一致复制、计算与存储分离、**从以磁盘为中心到以内存为中心**，是三个非常显著的技术变迁。
3. 系统跟算法的结合越来越紧密，系统跟算法一起形成一家公司的技术的基石，系统相当于是骨架，而算法给骨架注入了灵魂。


软件架构，唯一不变的就是变化，但变化又分成了波动与趋势，所以对趋势的把握显得尤为重要。未来的两个预测

1. 架构智能化
2. 混合多云，接下来 5 到 10 年，很多大中型企业，他们重要的业务一定会横跨自己的数据中心和不同云服务商的数据中心。一定会有框架出现来屏蔽底层的这些差异与复杂性


## 其它

[一个架构师的感悟](https://mp.weixin.qq.com/s/_JehbhhUM0_x0akp61CFBA)因为软件是为了满足客户的功能性需求的，所以很多设计人员可能会认为架构是由要实现的功能性需求决定的。但实际上**真正决定软件架构的其实是非功能性需求**。架构师要更加关注非功能性需求，常见的非功能性包括：性能，伸缩性，扩展性和可维护性等，甚至还包括团队技术水平和发布时间要求。**能实现功能的设计总是有很多，考虑了非功能性需求后才能筛选出最合适的设计**。

许式伟：要提升架构能力，首先得做到规格为先，而不是实现为先。不要动不动问怎么实现的。要首先谈这个规格合不合理，是否存在多余的依赖。进一步来说，要多去谈这个函数（或软件实体）的业务范畴合不合理，是否应该换一个切分的姿势。在代码量非常大的时候，人的脑容量就完全无法把这个实现装到头脑中。这时 “规格重于实现” 背后的意义就完全体现出来了。通过规格串起整个业务系统，以此把业务系统装到脑子里，这就是很朴素的架构 “骨架” 思维。在极有限的时间里，在没有电脑的情况下，我们只能选择把更多的逻辑装进脑子里。这个过程还可以更进一步。**我们不断训练自己对不同业务领域的架构范式的理解。直至最终，我们头脑中可以装得下整个信息科技的骨架**。


