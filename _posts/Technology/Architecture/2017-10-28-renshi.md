---

layout: post
title: 对互联网系统的认识
category: 技术
tags: Architecture
keywords: push

---

## 简介（未完成）

### 基础知识

操作系统，磁盘，网络，体系结构思想（比如分层）

### 编程语言

及其应用技巧（比如设计模式）

编程语言的发展趋势

作为一个java程序员，通常很尴尬的一点是，很多基础组件例如mysql、redis、nginx等都由c语言开发，


### 具体组件

数据库，消息队列，虚拟化（docker等），redis等

### 系统架构

* 微服务 
* 一个问题在一个进程的多线程间存在，多半也在一台机器的多进程，多台机器的多进程间存在，而解决问题的思路多半是一样的，这也是学习基础的必要性所在。比如[一分钟实现分布式锁](http://www.10tiao.com/html/249/201612/2651959749/1.html)

### 业务架构

#### 分类

1. 典型架构：browser—server，app-server
	
	* [关于互联网“一致性”架构设计的一切](http://www.10tiao.com/html/249/201709/2651960408/1.html)
	* [互联网分层架构的本质](http://www.10tiao.com/html/249/201710/2651960455/1.html) 文章要点：互联网分层架构的本质，是数据的移动；互联网分层架构中，数据的传输格式（协议）与数据在各层次的形态很重要；互联网分层架构演进的核心原则与方法：封装与复用

2. 非典型架构：[秒杀，推送，广告，推荐，计数-互联网非典型业务系统架构设计](http://www.10tiao.com/html/249/201709/2651960426/1.html)

#### 设计

1. 满足业务需求
2. 解耦 [为什么说解耦的战术，决定了架构的高度？](http://www.sohu.com/a/204009990_411876)

	* ip耦合：使用内网域名代替内网ip
	* 公共库耦合：业务个性强的垂直拆分，公共特性强的下沉服务化
	* 数据库耦合：垂直切分与服务化
	* 服务化耦合：剥离业务代码上浮
	* 消息通知耦合：MQ
	* 下游扩容耦合：配置中心

## 一些体会

1. 很多技巧是通用的，比如批量，哪怕只取一条记录，操作系统也会从磁盘上将记录所在磁盘块读到内存。对于到mysql则是一个数据页，业务系统经常一次查询多个id。其它诸如缓存等莫不如是。
2. 很多问题是通用的，这点跟第一点一脉相承。比如线程安全问题，操作系统有，mysql也有，业务系统也经常有。异步io，可以在上层如业务或mysql中伪装实现，也可以直接操作系统提供。一个问题，在哪个层次解决最合适，也是一个问题。
3. 由[互联网分层架构的本质](http://www.10tiao.com/html/249/201710/2651960455/1.html) 想到的数据在不同介质的表现形式，以mysql innodb存储引擎为例

	||表现形式|
	|---|---|
	|业务系统|一个数据对象|
	|java对象在内存|参见java对象内存模型|
	|mysql逻辑上|一行记录|
	|mysql一行记录在内存|例如compact、redundant等行记录格式|
	|mysql一页记录在内存|例如antelope、barracuda等格式|
	|mysql一页记录在文件系统|假设页大小16kb，内存数据整体复制到磁盘，地址范围page offset ~ page offset + 16kb|
	|mysql表数据在硬盘|假设启动innodb_file_per_table，对应一个xx.ibd文件|
	|一个文件在操作系统|file id|
	|一个文件在磁盘|几个磁盘块 + 部分inode块|
	
4. 上层抹不去的底层印记。磁盘天然的随机读写慢于顺序读写，迫使os、mysql进行了大量的缓冲优化。cpu缓存、java内存模型导致的变量可见性问题，事务可见性问题等。