---

layout: post
title: 平台支持类系统的几个点
category: 技术
tags: Architecture
keywords: abtest

---

## 简介（未完成）

此处主要指 客户端版本管理系统、配置中心系统、abtest 系统、上传系统、推送系统等 跟app 业务不直接关联，但仍是每个app 的必要的 “业务” 系统。

平台支持 系统 是笔者用以对这几个系统的统称，他们与一般业务系统有以下不同

1. 一般业务系统 请求 ==> 响应 ==> 展示给用户 就结束了。而平台支持类系统则是 请求 ==> 响应 ==> 数据存在本地 ==> 在恰当的时机生效。
2. 客户端 本地数据 需要与服务端 做同步
3. 如果将app 分为 业务/基础环境 两个层次的话，其运行属于“基础环境”的一部分

下文以一个文件下发系统为例，即app 启动时/某个业务点击时 向服务端拉取 适配客户端的文件，客户端下载文件 并应用在本地。

平台支持类系统 有很多的共同点，这也就意味着，很多共同点可以作为框架抽取出来。

## 几个基本的功能点

### 匹配

1. 条件匹配，将文件推送符合一定特征的用户

	* 设备信息，比如android/ios 等
	* app 信息，比如版本号、渠道号
	* 用户画像信息，比如儿童、老人等
	* 测试信息，比如请求来自一个内部测试设备，可以访问未发布的文件

2. 精确匹配，将文件推送给一个hdfs 文件（用户id 列表）

### 下发

下发什么？

1. 数据
2. 状态，比如提前终止一个文件下发，除新的请求无法获取文件外，还要通知已获取文件的设备禁用该文件

下发方式：

1. 全量，适用于一段时间有效文件 数量有限的业务
2. 增量

### 灰度下发

### 支持多应用

### 数据的组织

对不同的业务 有以下场景：

1. 获取所有适配的文件
2. 获取某个类型的文件
3. 获取某个模块的文件

数据的组织 应该后台界面设计时 有所体现

## 基本准备

### 客户端信息 标准化

### 安全

### 权限管理

1. 超级管理员						可以做一切事情
2. app 管理员						app 范围内可以做一切事情
2. 文件某个组织维度的管理员			审核
2. 文件创建者		创建、修改

[初级权限系统设计](http://qiankunli.github.io/2017/12/29/permission_system.html)

### 下发进度统计

### 精确到个人的日志记录

## 性能

### 缓存/打掉缓存

### 推拉

## 维护

### 警惕app 发版、新数据 对系统的影响

## 生命周期

平台支持类的项目，基本在跟着 客户端发版走，所以很多开发节点 要跟得上 客户端发版。

## 通用架构

前文都是从 单个项目来考虑的，多个类似的项目放在一起，我们就可以发现，其实有很多共用的部分。


### 一切皆配置

![](/public/upload/architecture/client_support_client_1.png)

所有业务 以配置形式存在，通过配置中心 下发到客户端，客户端同时拉取 用户画像数据，据此根据 相应的配置数据 进行 匹配，进而产生 相应的业务行为。

### 各自为政

![](/public/upload/architecture/client_support_client_2.png)

当然，在实际实施的过程作用，还可以有一个变种：即数据还是走配置中心全量下发，客户端另外发请求 查询匹配的数据（下发和匹配过程分开），此时服务端只返回匹配的id 即可。

### 对比

两个方案 一个侧重客户端，一个侧重服务端。理论上，第一个更轻省些，但对客户端的能力要求较高。业务架构 影响/被影响 团队架构，笔者第一次有如此切身的体会。  